syntax = "proto3";

package app;

// 记录仪 -> 手机
// float yaw = 1;
// float pitch = 2;
// float roll = 3;
// repeated int32 xyxy = 2;
message FaceResult {       
    repeated float feature = 1; // [f32; 512]
    bytes image = 2;
    optional string task = 3;
}
// 记录仪 -> 手机
message CarResult {
    string plate_number = 1;
    bytes image = 2;
    optional string task = 3;
}
// 边缘 -> 手机
message CigarettesResult {  
    message Class {
        string class = 1;
        uint32 x1 = 2;
        uint32 x2 = 3;
        uint32 y1 = 4;
        uint32 y2 = 5;
    }
    repeated Class classes = 1;
    bytes image = 2;
    optional string task = 3;
}

message Handshake {
    string id = 1;  // 记录仪, 边缘 -> 手机 
}
message DetectRequest {
    int32 type = 1;  // 0 - cigarette  手机 -> 边缘
    bytes image = 2;
}
message DetectResponse {
    CigarettesResult cigarettes_result = 1; // 边缘 -> 手机
    CarResult car_result = 2;               // 记录仪 -> 手机
    FaceResult face_result = 3;             // 记录仪 -> 手机
}

message Msg {
    oneof msg {
        Handshake handshake = 1;
        DetectRequest detect_request = 2;
        DetectResponse detect_response = 3;
    }
}