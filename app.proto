syntax = "proto3";

package app;

/* layer custom */
message Geo {
    double lat = 1;
    double lng = 2;
}
message Landmark {
    float x = 1;
    float y = 2;
}

/* layer 2 */
message FaceResult { // 记录仪 -> 手机 float yaw = 1; float pitch = 2; float roll = 3; repeated int32 xyxy = 2;      
    repeated float feature = 1;
    bytes image = 2;
    float confidence = 3;
    repeated Landmark landmarks = 4;
}
message CarResult { // 记录仪 -> 手机
    string plate_number = 1;
    bytes image = 2;
}
message CigarettesResult { // 边缘 -> 手机 
    message Class {
        string class = 1;
        uint32 x1 = 2;
        uint32 x2 = 3;
        uint32 y1 = 4;
        uint32 y2 = 5;
    }
    repeated Class classes = 1;
    bytes image = 2;
}
message LicenseResult { // 边缘 -> 手机
    repeated string texts = 1;
    bytes image = 2;
}

/* layer 1 */
message Handshake { // 记录仪, 边缘 -> 手机
    string id = 1; // "bodycam" "edge"
}
message EdgeStatusReq {
}
message EdgeStatusResp {
    int32 temp = 1;
    float batter = 2;
}
message DetectReq { // 手机 -> 边缘
    int32 type = 1; // 1 - cigarette, 40 - license_biz, 41 - license_cig
    bytes image = 2;
}
message RecordReq { // 手机 -> 记录仪
}
message RecordResp { // 记录仪 -> 手机
    bytes video = 1;
    bytes cover_image = 2;
}
message DetectResp {
    CigarettesResult cigarettes_result = 1; // 边缘 -> 手机
    CarResult car_result = 2;               // 记录仪 -> 手机
    FaceResult face_result = 3;             // 记录仪 -> 手机
    LicenseResult license_result = 4;       // 边缘 -> 手机
    optional string id_schedule = 5;        // 手机 -> 服务器
    optional Geo geo = 6;                   // 手机 -> 服务器
    optional string id_retail = 5;          // 手机 -> 服务器
}

/* layer 0 */
message Msg {
    oneof msg {
        Handshake handshake = 1;
        EdgeStatusReq edge_status_req = 2;
        EdgeStatusResp edge_status_resq = 3;
        DetectReq detect_req = 4;
        DetectResp detect_resp = 5;
        RecordReq record_req = 6;
        RecordResp record_resp = 7;
    }
}